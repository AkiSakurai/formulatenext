From 0a5c2e77813b379d7b67e45033237eaf94561703 Mon Sep 17 00:00:00 2001
From: Andrew de los Reyes <adlr@chromium.org>
Date: Sun, 19 Jan 2020 13:37:37 -0800
Subject: [PATCH 1/3] adlr: support for building for wasm

---
 build/config/BUILDCONFIG.gn | 13 ++++++++++++-
 1 file changed, 12 insertions(+), 1 deletion(-)

diff --git a/build/config/BUILDCONFIG.gn b/build/config/BUILDCONFIG.gn
index 8567202..5e93826 100644
--- a/build/config/BUILDCONFIG.gn
+++ b/build/config/BUILDCONFIG.gn
@@ -195,6 +195,7 @@ if (current_os == "win") {
   is_linux = false
   is_mac = false
   is_posix = false
+  is_wasm = false
   is_win = true
 } else if (current_os == "mac") {
   is_android = false
@@ -205,6 +206,7 @@ if (current_os == "win") {
   is_linux = false
   is_mac = true
   is_posix = true
+  is_wasm = false
   is_win = false
 } else if (current_os == "android") {
   is_android = true
@@ -215,6 +217,7 @@ if (current_os == "win") {
   is_linux = false
   is_mac = false
   is_posix = true
+  is_wasm = false
   is_win = false
 } else if (current_os == "chromeos") {
   is_android = false
@@ -225,8 +228,9 @@ if (current_os == "win") {
   is_linux = true
   is_mac = false
   is_posix = true
+  is_wasm = false
   is_win = false
-} else if (current_os == "nacl") {
+} else if (current_os == "wasm") {
   # current_os == "nacl" will be passed by the nacl toolchain definition.
   # It is not set by default or on the command line. We treat is as a
   # Posix variant.
@@ -238,6 +242,7 @@ if (current_os == "win") {
   is_linux = false
   is_mac = false
   is_posix = true
+  is_wasm = true
   is_win = false
 } else if (current_os == "ios") {
   is_android = false
@@ -248,6 +253,7 @@ if (current_os == "win") {
   is_linux = false
   is_mac = false
   is_posix = true
+  is_wasm = false
   is_win = false
 } else if (current_os == "linux") {
   is_android = false
@@ -258,6 +264,7 @@ if (current_os == "win") {
   is_linux = true
   is_mac = false
   is_posix = true
+  is_wasm = false
   is_win = false
 } else if (current_os == "fuchsia" || target_os == "fuchsia") {
   is_android = false
@@ -268,6 +275,7 @@ if (current_os == "win") {
   is_linux = false
   is_mac = false
   is_posix = true
+  is_wasm = false
   is_win = false
 }
 
@@ -521,6 +529,9 @@ if (custom_toolchain != "") {
     host_toolchain = "//build/toolchain/linux:clang_$host_cpu"
   }
   set_default_toolchain("//build/toolchain/fuchsia")
+} else if (is_wasm) {
+  host_toolchain = "//build/toolchain/linux:$host_cpu"
+  set_default_toolchain("//build/toolchain/wasm:wasm")
 } else {
   assert(false, "Toolchain not set because of unknown platform.")
 }
-- 
2.11.0

